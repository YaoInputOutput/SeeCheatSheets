比特币部分参考自：[C语言中文网](http://c.biancheng.net/blockchain/)

# 目录

<!-- vim-markdown-toc GFM -->

- [加密技术](#加密技术)
  - [散列算法](#散列算法)
  - [对称加密技术](#对称加密技术)
  - [非对称加密技术](#非对称加密技术)
  - [数字证书](#数字证书)
  - [数字签名](#数字签名)
  - [安全隧道](#安全隧道)
  - [CIA：信息系统的安全等级的三个性质](#cia信息系统的安全等级的三个性质)
  - [电子商务的安全性](#电子商务的安全性)
- [基础概念](#基础概念)
- [核心概念](#核心概念)
  - [分布式账本](#分布式账本)
  - [区块链结构](#区块链结构)
  - [工作量证明](#工作量证明)
  - [最长链原则](#最长链原则)
  - [去中心网络](#去中心网络)

<!-- vim-markdown-toc -->
# 加密技术
## 散列算法
也可称作hash算法、信息摘要算法、不可逆加密技术  
[更多介绍](https://zhuanlan.zhihu.com/p/101390996)
* 原理：
    * 将给定的内容(不限字节大小)转换成一串固定字节大小的数值(称作hash值)，而该hash值串就作为给定内容的**指纹**，
        意思是你可以“完全”用该短小的hash值串代表给定的内容。
    * 换句话说，如果有两个文件A和B，他俩用同一个hash算法算出来的hash值是一样的，则可以认为这俩文件的内容完全一样。
        否则，即使他俩只有一个Byte的差别，得出的两个hash值也天差地别
* 性质：
    * 抗碰撞性：尽量避免冲突
    * 抗篡改性：只要改动一个字节得到的hash值也有很大不同
    * 查找效率：生成hash值的速度
    * 不可逆性：不可由hash值推出原文
* 作用：
    * 计算文本摘要(指纹)
    * 身份验证
        > 服务器存储明文密码的hash值，即使泄漏也无法得到密码
    * hash表(数据结构)
>

## 对称加密技术
注意该加密技术是可以解密的，和上面的hash不同
* 原理：
    * 通讯双方在通讯之前就约定一个加密密码(一个**数值**)，然后双方的通讯内容都用该密码加密
    * 加密方法就是，将**数值**和**明文通讯内容**作为参数传给一个加密算法，即可得到加密密文
    * 解密方法就是，将**数值**和**密文通讯内容**作为参数传给对应的解密算法，即可解密出原来的明文
* 作用：
    * 通讯加密
        > 双方的通讯约定使用同一种对称加密算法和统一密码加密，则只有双方可读
    * 文件加密
        > 将机密文件“上锁”，钥匙存脑子里:smile:是不是很有意思，看到后面，你会发现脑子还可以存你全身家当  
        > 轻装跑路不是梦🙈️
>

## 非对称加密技术
* 原理：
    * 私钥可以算出公钥，反之公钥无法算出私钥
    * 私钥加密需公钥解密，公钥加密需私钥解密
* 作用：
    * 身份验证
        > 数字证书与数字签名，见下
    * 通讯加密
        > 用对方的公钥加密，则只有对方(拥有对应私钥)能解密
>

## 数字证书
* 作用：确认访问的网站是相对安全的，它是经过权威的认证中心(**CA**)认证过身份的
* 原理：
    * CA发放证书，证书由CA的私钥加密，若由对应CA的公钥解密出正确信息即可确认证书不假
        > 由CA负责保证其私钥不会泄漏，从而杜绝伪造证书  
        > 注意上面说的是**证书不假**，证书是不是对方的还得继续往下看
    * 证书内容：
        * 签发者    ：即签发此证书的CA，隐含信息是告诉浏览器用哪个CA的公钥
        * 签给者    ：这个证书的主人的信息
        * 签给者URL ：签给者的URL，由浏览器确认你正在访问的网站是你希望访问的
        * 签给者公钥：这就是用来确认上面说的——对方是否为证书的主人
        * 等等...
        * **密文**  ：以上全是明文，此处的密文即由上面全部明文hash后再用CA的私钥加密得到。
            浏览器会将全部明文同样进行hash得到串**S1**，再用CA的公钥解密该密文得到串**S2**，
            若**S1**等于**S2**则说明证书是真的。
            > 用反证法可以证明：若证书为假(即密文并非由CA的私钥加密)，我们用CA的公钥解密出的**S2**
            > 应该是“乱码”(与**S1**碰撞的可能性极低)，这违背了非对称加密技术的性质——私钥加密只有公钥能解密。
            > 故得证，证书为真
>

## 数字签名
* 作用：确认消息的发送者确实是其附上公钥的主人
* 原理：
    * 首先，类似数字证书——将明文信息hash后用私钥加密，随明文一起发送，  
        明文的内容包括：
        * 发送方公钥
        * 正文信息(如发起的交易的信息)
    * 接收方用发送方公钥解密密文部分，在于明文hash后对比，若匹配则说明发送方确实是正文信息的主人
>

## 安全隧道
首先是SSL/TLS协议：
* 作用：客户端与服务器建立一个只有双方才能解密会话内容的加密通讯隧道
* 流程：
    * 客户端(**C**)发起连接请求，内容包括：协议版本、支持的加密算法等

    * 服务器(**S**)回传包括：协议版本、选择的加密算法、数字证书等

    * 如果证书验证通过(即对网站服务器的身份验证)，
        客户端会生成一个随机数，正式的安全隧道通信会使用对称加密，
        而该随机数值即作为对称加密的密码，然后发送握手消息，其中包括：
        1. 对称密码的密文(用证书上的公钥加密)
        2. 握手消息的密文(用上面的对称密码加密)
        3. 握手消息的hash值
        > 接下来，对客户端来说还需要确认的有：
        > * 对方(服务器)是证书的主人
        > * 对方已接收到正确的对称密码

    * 服务器接受消息后：
        1. 用**自己的私钥**解密出对称密码(若能正确执行此步骤，则该服务器确实是证书的主人)
        2. 并用该对称密码解密出握手消息
        3. 上一步解密出的握手消息hash后与接收到的握手消息hash值对比，确认密码可行性
        4. 回传包括：
            * 重新生成的握手信息的密文(用对称密码加密)
            * 重新生成的握手信息的hash值

    * 客户端接收回传信息：
        1. 解密握手信息，hash后对比接收的hash值
        2. 若相同，则证明了之前待确认信息
        3. 接下来的安全隧道即用该对称密码加密
>
SSH协议与此不同，因为HTTPS是用于网站访问的加密：服务器是开放的，客户端是陌生的  
而SSH协议是有**用户**这个概念的，若客户端不是服务器的注册用户则不可访问，
故连接过程需要验证用户身份，或者通过用户密码(散列算法)，或者用用户的私钥(非对称加密)，验证细节不再赘述

## CIA：信息系统的安全等级的三个性质
* 机密性(Confidentiality)   ：指只有用户可以获取信息
* 完整性(Intergrity)        ：接收方接收的数据与发送方发送的数据一致
* 可用性(Availability)      ：合法用户对信息和资源的使用不会被不正当的拒绝
> 可以将以上三条性质带入上面的流程中去，看看是否符合这些性质，又是如何达到这些性质  

## 电子商务的安全性
* 数据传输安全性：数据在传输过程中不会被窃取与篡改(对称加密技术,非对称加密技术与hash校验)
* 数据完整性    ：数据不会被篡改(由企业保证服务器安全，比特网中见后续)
* 身份验证      ：确认对方的真实身份(非对称加密技术)
* 不可抵赖性    ：交易双方在传输数据时，必须带有**自身特有**、**无法被别人复制**的信息，
    以保证交易发生纠纷是有所对证(数字签名与数字证书)

# 基础概念
* 首先得清楚**比特币**与**区块链**二者的关系：
    * 比特币是一种**计算机网络传输协议**，旨在*去中心化*
        > &emsp;思考一下，如今我们的大多数交易都是中心化的：微信支付以腾讯为中心，支付宝以阿里为中心，
        > 甚至我们用纸币也是以国家政府为中心。我们相信腾讯、阿里、国家可以保护我们的财产和交易，
        > 他们提供一个平台让大家更方便的交流。但所有这些都是基于信任的，我们相信他们不会搞些幺蛾子。  
        > &emsp;而比特币提供了一种交易网络系统，它是去中心化的——由全世界所有矿机来维护整个系统。
        > 这个分布式系统的运作不是基于你对它的信任，因为它是基于数学逻辑的。
    * 而区块链是是比特币的底层技术，它是一种**数据结构**(也可泛指一类技术)，旨在提供价值属性
        > &emsp;再思考一下，我们用来交易的东西是什么？一串数据流，一张纸，他们本身没有价值，
        > 是企业和国家告诉我们这些是有价值的，而他们则负责维护这些物品的价值属性。
        > 其中非常重要一条——不可复制性。如果你可以随意修改你支付宝上的余额，或者你可以随意印出堪比真钱的假钞，
        > 那它们就不可能有价值，天王老子说的都不算
>
* 比特币的基本组成：
    * 加密数字货币
    * 分布式账本
    * 去中心网络
>
* 核心问题：
    * 你是钱包主人？
    * 你的资产是正确的？
    * 去中心化分布式系统的运作？
        * 信息篡改
        * 双花问题
        * 信息同步

# 核心概念
![区块链](../images/blockchain.jpg)
## 分布式账本
* 交易记录：
    * IN    ：上次交易条款号
    * OUT   ：目标账户
    * COUNT ：交易数目
    * 交易发起人(付费方)的数字签名
* 账户钱包：
    * 即用户私钥对应的公钥，也被称作钱包地址
    * 比特币中没有一个专门的地方存储你的账户余额，见下UTXO，以太坊因为其它考虑而没有用UTXO的设计
* 账户余额：
    * 用户的资产即UTXO(未使用的交易输出)
        > 在比特币系统中，所有输出(OUT)是你的地址的交易记录，它们的资产总和就是你的资产，确认余额正确性
        > 只需要追溯到上次交易即可
    * 进行交易时，由付款者对它的一条UTXO签名，其中OUT为收款者，提交交易到比特币系统
        > 动用的UTXO大于应付款，则可以将再加一个OUT指向自己的钱包地址进行“找零”操作
>

## 区块链结构
* 上一区块hash值
    > 防止篡改。若试图篡改一个区块内容，则需要连着更改该区块之后的所有区块
* 交易记录
    > 以梅克尔树的形式存储该区块中的所有交易记录，该数据结构也具有防止篡改的特性  
* <span id="nonce">Nonce</span>
    > 用于工作量证明
>

## 工作量证明
* 奖励机制
    * 维护全节点的矿机可获取创币交易(比特币的发行)，该奖励每四年减半(模拟黄金的开采)
    * 收取交易的手续费，大概为1%
* 记账权利
    * 将比特币网络中的未确认交易按梅克尔树组装成块，未纳入的交易往下顺延
* 工作量证明(重点)
    * 所有矿机进行算力竞争，首个胜出的矿机获取记账权
        > 算力竞争，即共同做一道数学题：找到一个值[Nonce](#nonce)，让接下来的区块的hash值的后缀
        > 为某一个值，这道题只有通过暴力破解，且会由整个比特币系统根据过去的数据动态调整以控制在10分钟左右
        > (硬件的算力在逐年提升)
* 整个流程描述为：算力竞争，获取记账权，创建区块并广播，获得奖励
>

## 最长链原则
* 广播的区块链遇到冲突会抛弃短链选择长链，所以会导致交易失败
>

## 去中心网络
* 全节点：存储所有交易信息的区块链
* 轻节点：只存储关链信息，其余联网取得
* 矿工节点：负责工作量证明赢取记账权的节点
* 比特币总量不变

